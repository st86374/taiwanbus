import{u as W,k as Y,l as q,m as c,b as J,q as X,n as Q,p as tt,o as m,s as et,t as O,e as st,f as t,B as n,d as g,x as _,z as k,w as R,v as j,c as b,y as ot,F as at,C as lt}from"./vendor.1559e045.js";import{b as nt,c as it,d as rt}from"./bus.b2b14fe2.js";import{B as ut,c as ct,_ as dt}from"./Header.2bd7d6c6.js";import{d as pt,m as vt,L as mt}from"./index.esm.4bcc8d34.js";import"./index.96a65109.js";const gt={class:"fixed top-[48px] max-w-md mx-auto w-full text-gray-400 bg-white dark:bg-black p-3"},ht={class:"grid grid-cols-2 grid-rows-1"},_t={class:"py-2"},bt={class:"text-xl text-main"},xt={class:""},wt={class:"text-sm text-right"},ft={class:"flex items-center justify-end my-2"},kt={class:"grid grid-cols-2 grid-rows-1"},yt={class:"mt-[166px]"},St={class:"z-[5]"},Pt=t("div",{class:"w-full h-[50vh]",id:"map"},null,-1),Dt=[Pt],Ct=["onClick"],It={key:1,class:"p-2 text-center text-white bg-gray-700 basis-1/3"},Lt={class:"p-2 text-lg font-bold text-right rounded basis-2/3"},Et={key:0,class:"fixed top-0 z-20 w-full h-full max-w-md mx-auto bg-black/50 backdrop-blur-md"},Tt={class:"relative w-full h-full"},$t={class:"absolute w-[90%] right-2/4 bottom-2/4 translate-x-2/4 translate-y-2/4 rounded-lg bg-white dark:bg-black"},Mt={class:"flex items-center justify-between p-2 text-lg text-gray-400 border-b"},Bt=t("p",null,"\u516C\u8ECA\u8CC7\u8A0A",-1),At=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Nt=[At],Ot={class:"p-3 text-black dark:text-white"},Rt=t("p",{class:"text-lg text-main text-bold"},"\u982D\u672B\u73ED\u8ECA\uFF1A",-1),jt=t("p",{class:"text-lg text-main text-bold"},"\u6536\u8CBB\u65B9\u5F0F\uFF1A",-1),zt=t("p",{class:"text-lg text-main text-bold"},"\u5BA2\u904B\u696D\u8005\uFF1A",-1),Zt={class:"text-center"},Vt=["href"],qt={setup(Gt){const x=W(),C=Y(),z=q();let I=!1;const{city:p,bus:w}=C.params,L=c(),o=c(0),E=c([]),r=c({}),y=c(Date.now()+30*1e3),T=c(),h=c(!1),i=c([]),S=c(!1),Z=s=>{ct.forEach(e=>{e.value===p&&(L.value=e.name)})},$=()=>{x.dispatch("handLoadingToggle"),rt(p,w).then(s=>{let e=s.data.sort((a,v)=>a.StopID-v.StopID),d=[];for(let a=0;a<e.length;a++)(a===0||e[a].StopID-e[0].StopID<1e4)&&d.push(e[a]);E.value=d,x.dispatch("handLoadingToggle")}).catch(s=>{console.log(s)})},P=J(()=>x.getters.theme),V=async()=>{try{const s=await nt(p,w);r.value=s.data[0]}catch(s){console.log(s)}},G=s=>{switch(Number(s)){case 1:return"\u5C1A\u672A\u767C\u8ECA";case 2:return"\u4EA4\u7BA1\u4E0D\u505C\u9760";case 3:return"\u672B\u73ED\u99DB\u96E2";case 4:return"\u4ECA\u65E5\u505C\u99DB"}},F=s=>s<60?"\u9032\u7AD9\u4E2D":s<180?"\u5373\u5C07\u9032\u7AD9":`${Math.ceil(s/60)-1}\u5206\u9418`,U=async()=>{try{const s=await it(p,w);i.value=s.data,$()}catch(s){console.log(s)}},H=()=>{try{let s=C.fullPath.toString(),e=s.indexOf("="),d=s.indexOf("=",e+1),a=s[e+1];o.value=a?1:0}catch(s){console.log(s)}},u=c({google:null,map:null,markers:null}),f=async s=>{const e=new mt({apiKey:"AIzaSyAFKPiMUc5jyVnzoWAJush-EDagXdyHgVc",version:"weekly",libraries:["places"],language:"zh-TW"});u.value.google=await e.load(),u.value.map=new u.value.google.maps.Map(document.getElementById("map"),{center:{lat:i.value[o.value].Stops[0].StopPosition.PositionLat,lng:i.value[o.value].Stops[0].StopPosition.PositionLon},zoom:16,maxZoom:20,minZoom:3,streetViewControl:!1,mapTypeControl:!1,disableDefaultUI:!0,styles:s?"":pt}),u.value.markers=[],i.value[o.value].Stops.forEach(a=>{let v={lat:a.StopPosition.PositionLat,lng:a.StopPosition.PositionLon};u.value.markers.push(v)}),new google.maps.Polyline({path:u.value.markers,geodesic:!0,strokeColor:"#F97316",strokeOpacity:1,strokeWeight:2}).setMap(u.value.map),K(u.value.map)},K=()=>{for(let e=0;e<i.value[o.value].Stops.length;e++)if(i.value[o.value].Stops[e].StopID-i.value[o.value].Stops[0].StopID<1e4){const d=new google.maps.InfoWindow({width:320,content:`<div class="w-full text-center min-w-[100px] min-h-[55px]">
        <p class="mb-3 font-bold text-md">${e+1}. ${i.value[o.value].Stops[e].StopName.Zh_tw}</p>
        <div>
        <a class="p-2 text-white rounded bg-main" href="/${p}/stop/${i.value[o.value].Stops[e].StopName.Zh_tw}">\u516C\u8ECA\u67E5\u8A62</a>
        </div>
        </div>`});var s={url:vt,scaledSize:new google.maps.Size(24,32)};const a=new google.maps.Marker({position:{lat:i.value[o.value].Stops[e].StopPosition.PositionLat,lng:i.value[o.value].Stops[e].StopPosition.PositionLon},icon:s,map:u.value.map});a.addListener("click",()=>{d.open({anchor:a,map:u.value.map})})}},D=()=>{setTimeout(()=>{if(I)return;const s=y.value-Date.now();T.value=Math.ceil((y.value-Date.now())/1e3),s<=0&&($(),y.value=Date.now()+30*1e3),D()},1e3)};return X(()=>x.getters.theme,(s,e)=>{f(s)}),Q(()=>{Z(),U(),V(),D(),H()}),tt(()=>{I=!0}),(s,e)=>(m(),et(ut,null,{header:O(()=>[st(dt)]),body:O(()=>{var d,a,v,M,B,A,N;return[t("div",gt,[t("div",ht,[t("div",_t,[t("p",null,n(L.value)+"\uFF5C\u516C\u8ECA",1),t("p",bt,n(g(w)),1)]),t("div",xt,[t("p",wt,n(T.value)+"\u79D2\u5F8C\u66F4\u65B0",1),t("div",ft,[t("button",{class:"p-2 mr-2 text-black bg-gray-200 rounded-lg dark:text-white dark:bg-gray-800",onClick:e[0]||(e[0]=_(l=>S.value=!0,["prevent"]))}," \u516C\u8ECA\u8CC7\u8A0A "),t("button",{id:"testt",class:"p-2 text-black bg-gray-200 rounded-lg dark:text-white dark:bg-gray-800",onClick:e[1]||(e[1]=_(l=>{h.value=!h.value,f(g(P))},["prevent"]))},n(h.value?"\u5730\u5716\u95DC\u9589":"\u5730\u5716\u986F\u793A"),1)])])]),t("div",kt,[t("button",{class:k(["truncate border-b-2",{"border-main":o.value==0,"text-main":o.value==0,"border-transparent":o.value!=0}]),onClick:e[2]||(e[2]=_(l=>{o.value=0,f(g(P))},["prevent"]))},n(`\u5F80${r.value.DestinationStopNameZh}`),3),t("button",{class:k(["truncate border-b-2",{"border-main":o.value==1,"text-main":o.value==1,"border-transparent":o.value!=1}]),onClick:e[3]||(e[3]=_(l=>{o.value=1,f(g(P))},["prevent"]))},n(`\u5F80${r.value.DepartureStopNameZh}`),3)])]),t("div",yt,[R(t("div",St,Dt,512),[[j,h.value]]),t("div",{class:k(["px-3 overflow-y-scroll bg-white dark:bg-black dark:text-white",{"max-h-[calc(50vh-164px)]":h.value}])},[(m(!0),b(at,null,ot(E.value,l=>R((m(),b("a",{key:l.StopID,class:"flex flex-row block my-3 overflow-hidden bg-gray-200 rounded-lg dark:bg-gray-800 items-inherit",onClick:_(Ft=>g(z).push(`/stop/${g(p)}/${l.StopName.Zh_tw}`),["prevent"])},[l.StopStatus===0?(m(),b("div",{key:0,class:k(["p-2 text-center text-white basis-1/3",{"bg-main":l.EstimateTime<60,"bg-main/75":l.EstimateTime<=180&&l.EstimateTime>=60,"bg-gray-500":l.EstimateTime>181}])},[t("p",null,n(F(l.EstimateTime)),1)],2)):(m(),b("div",It,[t("p",null,n(G(l.StopStatus)),1)])),t("p",Lt,n(l.StopName.Zh_tw),1)],8,Ct)),[[j,l.Direction==o.value]])),128))],2)]),S.value?(m(),b("div",Et,[t("div",Tt,[t("div",$t,[t("div",Mt,[Bt,t("div",{onClick:e[4]||(e[4]=l=>S.value=!1)},Nt)]),t("div",Ot,[Rt,t("p",null,"\u5E73\u65E5\uFF1A"+n((d=r.value)==null?void 0:d.SubRoutes[0].FirstBusTime)+"-"+n((a=r.value)==null?void 0:a.SubRoutes[0].LastBusTime),1),t("p",null,"\u5047\u65E5\uFF1A"+n((v=r.value)==null?void 0:v.SubRoutes[0].HolidayFirstBusTime)+"-"+n((M=r.value)==null?void 0:M.SubRoutes[0].HolidayLastBusTime),1),jt,t("p",null,n(((B=r.value)==null?void 0:B.TicketPriceDescriptionZh)||"-"),1),zt,t("p",null,n((A=r.value.Operators[0])==null?void 0:A.OperatorName.Zh_tw),1),t("div",Zt,[t("a",{class:"inline-block px-3 py-2 text-white rounded bg-main",target:"_blank",href:(N=r.value)==null?void 0:N.RouteMapImageUrl},"\u8A73\u7D30\u8CC7\u8A0A",8,Vt)])])])])])):lt("",!0)]}),_:1}))}};export{qt as default};
